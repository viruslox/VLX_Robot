# VLX_Robot - OBS Alert Overlay System

VLX_Robot is a self-hosted Go backend server for managing OBS alerts and overlays, with integration for Twitch events (via EventSub) and YouTube events (via API Polling).
NOTE: The idea, the logics, the architecture, reviews, validation are made in VirusLox, but the code is 95% generated by Gemini 2.5
Please check TODO file to keep track of what we still missing...todo

## Project Structure

```bash
VLX_Robot/
├── go.mod                # Go module definition file
├── go.sum                # Dependency checksums
├── main.go               # Application entry point. Starts the server.
├── config.yml            # Configuration (DB string, Twitch/YT API keys)
|
├── internal/             # Private Go project code
│   ├── config/           # Logic for loading config.yml
│   │   └── config.go
│   ├── database/         # Logic for PostgreSQL connection
│   │   └── postgres.go   # (Saves state and tokens)
│   ├── server/           # HTTP server logic
│   │   ├── server.go     # (Sets up public routes: /ws, /static/*, /webhooks)
│   │   └── test_server.go# (Private local server for manual alert testing)
│   ├── websocket/        # WebSocket Hub logic
│   │   ├── hub.go        # (Manages connections/broadcasts to overlays)
│   │   └── client.go
│   ├── twitch/           # Logic for Twitch Integration
│   │   ├── eventsub.go   # (Handles Webhooks: Follows, Subs, Raids)
│   │   └── chat.go       # (Handles IRC: Chat commands !cmd, Cooldowns, Permissions)
│   └── youtube/          # Logic for YouTube Integration
│       └── youtube.go    # (Handles Polling: SuperChats, Sticker, Commands)
│
└── static/               # <-- THIS IS YOUR FRONTEND FOLDER
    ├── overlay.css       # Shared styles for all overlays
    ├── alerts_overlay.html # Visual overlay for Alerts (Follows, Subs, SuperChats)
    ├── alerts_overlay.js   # Logic for visual alerts
    ├── chat_overlay.html   # Hidden overlay for playing Audio/Video commands
    ├── chat_overlay.js     # Logic for media playback
    ├── emotes_overlay.html # Overlay for the floating "Emote Wall"
    ├── emotes_overlay.js   # Logic for emote physics/animation
    └── chat/             # Audio/Video assets storage
        ├── everyone/     # Commands available to everyone
        ├── subscribers/  # Commands for Subs only
        └── vips/         # Commands for VIPs/Mods
```

## System Overview

The application operates as a standalone HTTP and WebSocket server. It ingests events from streaming platforms—via **EventSub Webhooks** for Twitch and **API Polling** for YouTube—and broadcasts normalized payloads to connected frontend clients (OBS Browser Sources). State persistence and token lifecycle management are handled via **PostgreSQL**.

## Key Features

### Twitch Integration

  * **EventSub Webhooks:** Real-time processing of high-priority events including Follows, Subscriptions, Gift Subs, Cheers (Bits), and Raids.
  * **Interactive Chat Bot:** Built-in IRC client that monitors chat for command triggers.
  * **RBAC Audio/Video Commands:** Role-Based Access Control for media commands. Access levels are strictly enforced:
      * **Everyone:** Public commands available to all users.
      * **Subscribers:** Exclusive commands for active subscribers and founders.
      * **VIPs/Mods:** Privileged commands for VIPs, Moderators, and the Broadcaster.
  * **Emote Wall:** Automatic extraction of emotes from chat messages, rendered as floating animations on a dedicated overlay.

### YouTube Live Integration

  * **Live Chat Polling Engine:** A configurable polling mechanism (default 5s interval) that monitors the active live stream.
  * **Monetization Alerts:** Detection and alerting for **Super Chats** and **Super Stickers**.
  * **Cross-Platform Commands:** Support for text-triggered media commands (`!command`) within YouTube chat, mapping permissions to Moderators and Sponsors (Members).
  * **State Persistence:** Automated tracking of `LiveChatID` and `NextPageToken` in PostgreSQL to ensure seamless resumption after service restarts.

### Overlay System

The frontend utilizes a low-latency WebSocket connection to render assets dynamically:

  * **Alerts Overlay:** Displays visual notifications for monetization and engagement events.
  * **Chat Media Overlay:** dedicated layer for playing audio/video assets triggered by chat commands.
  * **Emote Wall Overlay:** Renders physics-based floating emotes based on real-time chat activity.

-----

## Prerequisites

  * **Go:** Version 1.20 or higher.
  * **PostgreSQL:** A running instance for data persistence.
  * **Twitch Developer Application:** Required for Client ID, Client Secret, and User Access Tokens.
  * **Google Cloud Project:** With **YouTube Data API v3** enabled and an API Key.
  * **Reverse Proxy (Recommended):** Nginx or Apache with SSL termination (required for Twitch EventSub webhooks).

-----

## Configuration

The system is driven by a `config.yml` file. Ensure all credentials are secured.

### 1\. Base Configuration

Define the server ports and the public-facing URL (critical for webhook verification).

```yaml
server:
  base_url: "https://your-domain.com" # Public HTTPS URL
  port: "8000"       # Public traffic (Webhooks/Overlay)
  test_port: "8001"  # Private local testing endpoint
```

### 2\. Twitch Authentication

Requires a **User Access Token** with specific scopes (`channel:read:subscriptions`, `bits:read`, etc.) for full functionality.

```yaml
twitch:
  client_id: "YOUR_CLIENT_ID"
  client_secret: "YOUR_CLIENT_SECRET"
  webhook_secret: "YOUR_RANDOM_SECRET_STRING"
  user_access_token: "YOUR_GENERATED_USER_TOKEN"
  chat:
    bot_username: "BotAccountName"
    bot_token: "oauth:YOUR_BOT_TOKEN"
    channel_to_join: "TargetChannel"
    command_cooldown: 15 # Global command cooldown in seconds
```

### 3\. YouTube Settings

Configure the polling interval and target channel.

```yaml
youtube:
  api_key: "YOUR_GOOGLE_API_KEY"
  channel_id: "YOUR_CHANNEL_ID" # e.g., UCxxxxxxxxxxxx
  polling_interval: 5 # Polling frequency in seconds (Min: 5, Max: 60)
```

-----

## Installation & Deployment

1.  **Clone the Repository:**

    ```bash
    git clone https://github.com/your-username/VLX_Robot.git
    cd VLX_Robot
    ```

2.  **Install Dependencies:**

    ```bash
    go mod tidy
    ```

3.  **Database Setup:**
    Ensure your PostgreSQL instance is running and the credentials in `config.yml` are correct. The application will manage its own tables (`twitch_credentials`, `twitch_subscriptions`, `youtube_state`).

4.  **Build and Run:**

    ```bash
    go build -o vlx_robot main.go
    ./vlx_robot
    ```

-----

## Alternative (old style) build method:

```bash
mkdir -p ~/go/src/
cd ~/go/src/
wget https://github.com/viruslox/VLX_Robot/archive/refs/heads/main.zip
unzip main.zip && rm main.zip
mv VLX_Robot* VLX_Robot
cd VLX_Robot
go mod init
go mod tidy
go build
```

## OBS Studio Integration

Add the following **Browser Sources** to your OBS scenes. Set the dimensions to your canvas size (e.g., 1920x1080).

1.  **Main Alerts:**

      * URL: `http://localhost:8000/static/alerts_overlay.html`
      * *Usage:* Handles Follows, Subs, Raids, and Super Chats.

2.  **Chat Commands (Audio/Video):**

      * URL: `http://localhost:8000/static/chat_overlay.html`
      * *Usage:* Invisible layer that plays media when commands (e.g., `!sound`) are triggered.
      * *Note:* Enable "Control audio via OBS" if you need to route audio through specific tracks.

3.  **Emote Wall:**

      * URL: `http://localhost:8000/static/emotes_overlay.html`
      * *Usage:* Renders floating emotes from chat messages.

-----

## Asset Customization

To add new chat commands, place media files (`.mp3`, `.wav`, `.mp4`, `.webm`) in the corresponding permission directories within `static/chat/`. The filename becomes the command trigger.

  * **Public Commands:** Place files in `static/chat/everyone/`
      * *Example:* `static/chat/everyone/hello.mp3` -\> Command: `!hello`
  * **Subscriber Only:** Place files in `static/chat/subscribers/`
  * **VIP/Mod Only:** Place files in `static/chat/vips/`

**Note:** The system automatically detects new files upon restart. Use the `!commands` command in chat to list available triggers for your permission level.

## Overlay self-test

### Twitch follow
curl -X POST -d '{"type":"twitch_follow", "user_name":"UtenteDiTest"}' http://localhost:8001/test/alert

### YouTube superchat
curl -X POST -d '{"type":"youtube_super_chat", "user_name":"DonatoreTest", "amount_string":"€5.00", "message":"Test alert!"}' http://localhost:8001/test/alert

### Twitch raid
curl -X POST -d '{"type":"twitch_raid", "raider_name":"StreamerAmico", "viewers":120}' http://localhost:8001/test/alert

### Twitch subscriptions
curl -X POST -d '{"type":"twitch_subscribe", "user_name":"NuovoSub", "tier":"Tier 1", "months":1}' http://localhost:8001/test/alert
curl -X POST -d '{"type":"twitch_resubscribe", "user_name":"VecchioAmico", "tier":"Tier 2", "months":6, "message":"Sempre un grande!"}' http://localhost:8001/test/alert
curl -X POST -d '{"type":"twitch_gift_sub", "user_name":"Benefattore", "recipient_name":"Fortunato", "tier":"Tier 1"}' http://localhost:8001/test/alert

### Twitch cheers
curl -X POST -d '{"type":"twitch_cheer", "user_name":"Tifoso", "bits":500, "message":"Per la nuova sedia!"}' http://localhost:8001/test/alert

curl -X POST -d '{"type":"youtube_member", "user_name":"MembroYT", "level":"Livello Fan"}' http://localhost:8001/test/alert

curl -X POST -d '{"type":"stream_tip", "user_name":"DonatoreSegreto", "amount_string":"€20.00", "currency":"EUR", "message":"Grande live!"}'
